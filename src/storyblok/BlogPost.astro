---
import { storyblokEditable, renderRichText, RichTextSchema } from '@storyblok/astro';
import RichTextRenderer from "storyblok-rich-text-astro-renderer/RichTextRenderer.astro";
import { RichTextType } from "storyblok-rich-text-astro-renderer";
import Link from "../custom_components/Link.astro";
import { Code } from "astro:components";

import { YouTube } from 'astro-embed';

import Text from "../components/Text.astro";

import BaseLayout from "../layouts/BaseLayout.astro";
import { Code } from 'astro:components';

import { marked } from 'marked';

const { blok } = Astro.props

const rawContent = blok.content;
const content = renderRichText(blok.content)

// var i=0;
// var j=0;

// while(i<blok.content.content.length) {
//   console.log(blok.content.content[i]);
//   var conArray = blok.content.content[i].content;
//   // while(conArray!=undefined && j<conArray.length) {
//   //   console.log(conArray[j]);
//   //   if(conArray[j].marks!=undefined) {
//   //     // console.log(conArray[j]);
//   //     // console.log("SPACE!!!!!!!!!!!!!!!")
//   //     // console.log(conArray[j].marks);
//   //   }
//   //   j++;
//   // }
//   // j=0;
//   i++;
// }

const { title, description } = blok;

import "../styles/blog.css";
import "../styles/Highlight JS/styles/kimbie-light.css";

---

<BaseLayout>
{/*  <script>
    import hljs from 'highlight.js';
    hljs.highlightAll();
  </script> */}


<article class="backdrop-blur-md p-4 shadow-[rgba(0,_0,_0,_0.2)_0px_60px_40px_-7px]">
{/* <article {...storyblokEditable(blok)} class="backdrop-blur-md p-4 shadow-[rgba(0,_0,_0,_0.2)_0px_60px_40px_-7px]"> */}
    <h1 class="my-12 text-5xl">{blok.title}</h1>
      <img
      class="w-full h-[360px] lg:h-[450px] object-cover"
      src={`${blok.image.filename}/m/1600x0`}
    />
    <div class="w-11/12">
      {/* <Fragment set:html={content} /> */}
      <RichTextRenderer 
        content={blok.content}
        schema={{
        nodes: {
          code_block: ({ attrs, content }) => ({
          component: Code, // native Astro Code component
          props: {
            lang: attrs.class?.split("-")[1],
            theme: "github-dark",
            code: content?.[0].text,
            },
          }),
        },
        marks: {
          link: ({ attrs }) => {
          const { custom, ...restAttrs } = attrs;

          return {
            component: Link,
            props: {
              link: { ...custom, ...restAttrs },
            },
          };
        },
        }
      }}
         {...storyblokEditable(blok)} />
    </div>  
{/*    <Code code="console.log('Hello world!')" lang="js" theme="light-plus"/> */}
  </article>
</BaseLayout>  